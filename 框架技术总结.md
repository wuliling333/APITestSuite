# APITestSuite æ¡†æ¶æŠ€æœ¯æ€»ç»“

> æœ¬æ–‡æ¡£æ€»ç»“æ¡†æ¶çš„æ ¸å¿ƒå®ç°åŸç†ã€è§£å†³çš„é—®é¢˜ã€ä»¥åŠå¼€å‘è¿‡ç¨‹ä¸­çš„å…³é”®æ³¨æ„äº‹é¡¹

---

## ğŸ“‹ ç›®å½•

1. [æ¡†æ¶æ ¸å¿ƒèƒ½åŠ›](#æ¡†æ¶æ ¸å¿ƒèƒ½åŠ›)
2. [è§£å†³çš„æ ¸å¿ƒé—®é¢˜](#è§£å†³çš„æ ¸å¿ƒé—®é¢˜)
3. [æ ¸å¿ƒå®ç°åŸç†](#æ ¸å¿ƒå®ç°åŸç†)
4. [å…³é”®æŠ€æœ¯ç‚¹](#å…³é”®æŠ€æœ¯ç‚¹)
5. [å®ç°è¿‡ç¨‹ä¸­çš„å…³é”®å‘](#å®ç°è¿‡ç¨‹ä¸­çš„å…³é”®å‘)
6. [æ¶æ„è®¾è®¡æ€è€ƒ](#æ¶æ„è®¾è®¡æ€è€ƒ)

---

## ğŸ¯ æ¡†æ¶æ ¸å¿ƒèƒ½åŠ›

### 1. è‡ªåŠ¨åŒ–æ¥å£å‘ç°

**èƒ½åŠ›**ï¼šä» Protobuf æ–‡ä»¶è‡ªåŠ¨è§£æAPIæ¥å£å®šä¹‰ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ¥å£åˆ—è¡¨

**å®ç°æ–¹å¼**ï¼š
- è§£æ `.proto` æ–‡ä»¶ï¼Œæå– `rpc` æ–¹æ³•å®šä¹‰
- è§£æè¯·æ±‚/å“åº”æ¶ˆæ¯ç»“æ„
- æ„å»ºæ¥å£å…ƒæ•°æ®ï¼ˆå­—æ®µåã€ç±»å‹ã€æ˜¯å¦å¿…å¡«ç­‰ï¼‰

**ä»·å€¼**ï¼šæ¥å£å˜æ›´æ—¶è‡ªåŠ¨åŒæ­¥ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–°

### 2. æ™ºèƒ½æµ‹è¯•ä»£ç ç”Ÿæˆ

**èƒ½åŠ›**ï¼šåŸºäºæ¥å£å®šä¹‰è‡ªåŠ¨ç”Ÿæˆ Python æµ‹è¯•ä»£ç 

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆJinja2ï¼‰ç”Ÿæˆæµ‹è¯•ä»£ç 
- æ”¯æŒ unittest å’Œ pytest ä¸¤ç§æ¡†æ¶
- æ”¯æŒ Page Object æ¨¡å¼ï¼ˆpytestç‰ˆæœ¬ï¼‰

**ä»·å€¼**ï¼šå‡å°‘90%ä»¥ä¸Šçš„æ‰‹å†™æµ‹è¯•ä»£ç å·¥ä½œé‡

### 3. äº”ç»´åº¦æµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨ç”Ÿæˆ

**èƒ½åŠ›**ï¼šè‡ªåŠ¨ç”Ÿæˆæ­£å¸¸ã€å‚æ•°å¼‚å¸¸ã€ä¸šåŠ¡å¼‚å¸¸ã€æƒé™å®‰å…¨ã€æ€§èƒ½è¾¹ç•Œäº”ç±»æµ‹è¯•ç”¨ä¾‹

**å®ç°æ–¹å¼**ï¼š
- æ­£å¸¸ç”¨ä¾‹ï¼šä½¿ç”¨åˆç†çš„é»˜è®¤å€¼
- å‚æ•°å¼‚å¸¸ï¼šç”Ÿæˆ5ç§é«˜é¢‘å¼‚å¸¸åœºæ™¯ï¼ˆå¿…å¡«ç¼ºå¤±ã€ç±»å‹é”™è¯¯ã€å€¼ä¸ºç©ºã€è¶…å‡ºèŒƒå›´ã€æ ¼å¼é”™è¯¯ï¼‰
- ä¸šåŠ¡å¼‚å¸¸ï¼šæ ¹æ®æ¥å£ç‰¹ç‚¹ç”Ÿæˆç‰¹å®šä¸šåŠ¡åœºæ™¯
- æƒé™å®‰å…¨ï¼šç”Ÿæˆæœªæˆæƒã€è¶Šæƒç­‰åœºæ™¯
- æ€§èƒ½è¾¹ç•Œï¼šç”Ÿæˆå¤§æ•°æ®é‡ã€å¹¶å‘ç­‰åœºæ™¯

**ä»·å€¼**ï¼šè¦†ç›–å…¨é¢çš„æµ‹è¯•åœºæ™¯ï¼Œå‡å°‘æµ‹è¯•ç”¨ä¾‹ç¼–å†™å·¥ä½œé‡

### 4. çœŸå®APIè°ƒç”¨

**èƒ½åŠ›**ï¼šç›´æ¥è¿æ¥æœåŠ¡å™¨è¿›è¡ŒçœŸå®APIè°ƒç”¨ï¼Œéæ¨¡æ‹Ÿæ•°æ®

**å®ç°æ–¹å¼**ï¼š
- HTTPç™»å½•è·å–token
- TCPè¿æ¥GateæœåŠ¡å™¨
- Protobufæ¶ˆæ¯ç¼–ç /è§£ç 
- çœŸå®RPCè°ƒç”¨

**ä»·å€¼**ï¼šçœŸå®ç¯å¢ƒæµ‹è¯•ï¼Œå‘ç°å®é™…é—®é¢˜å’Œæ€§èƒ½ç“¶é¢ˆ

### 5. å¤šæ ¼å¼æŠ¥å‘Šç”Ÿæˆ

**èƒ½åŠ›**ï¼šç”ŸæˆHTMLå’ŒExcelæ ¼å¼çš„è¯¦ç»†æµ‹è¯•æŠ¥å‘Š

**å®ç°æ–¹å¼**ï¼š
- HTMLæŠ¥å‘Šï¼šä½¿ç”¨Jinja2æ¨¡æ¿ï¼Œå¯è§†åŒ–å±•ç¤º
- ExcelæŠ¥å‘Šï¼šä½¿ç”¨openpyxlï¼Œç»“æ„åŒ–æ•°æ®
- åŒ…å«è¯·æ±‚å‚æ•°ã€å®é™…å“åº”ã€é”™è¯¯ä¿¡æ¯ã€é—®é¢˜åˆ†æ

**ä»·å€¼**ï¼šå¤šç»´åº¦æŸ¥çœ‹æµ‹è¯•ç»“æœï¼Œä¾¿äºé—®é¢˜å®šä½å’Œåˆ†æ

---

## ğŸ”§ è§£å†³çš„æ ¸å¿ƒé—®é¢˜

### é—®é¢˜1ï¼šæ¥å£å˜æ›´å¯¼è‡´æµ‹è¯•ä»£ç å¤§é‡ä¿®æ”¹

**é—®é¢˜æè¿°**ï¼š
- æ¥å£å®šä¹‰åœ¨Protobufæ–‡ä»¶ä¸­
- æ¥å£å˜æ›´æ—¶éœ€è¦æ‰‹åŠ¨æ›´æ–°æµ‹è¯•ä»£ç 
- å®¹æ˜“é—æ¼ï¼Œç»´æŠ¤æˆæœ¬é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è‡ªåŠ¨è§£æProtobufæ–‡ä»¶
- è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ä»£ç 
- æ¥å£å˜æ›´åé‡æ–°ç”Ÿæˆå³å¯

**æ•ˆæœ**ï¼šæ¥å£å˜æ›´æ—¶ï¼Œåªéœ€é‡æ–°è¿è¡Œç”Ÿæˆå‘½ä»¤ï¼Œæµ‹è¯•ä»£ç è‡ªåŠ¨æ›´æ–°

### é—®é¢˜2ï¼šæµ‹è¯•ç”¨ä¾‹ç¼–å†™å·¥ä½œé‡å¤§

**é—®é¢˜æè¿°**ï¼š
- æ¯ä¸ªæ¥å£éœ€è¦ç¼–å†™å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆæ­£å¸¸ã€å¼‚å¸¸ç­‰ï¼‰
- æµ‹è¯•ç”¨ä¾‹ç¼–å†™é‡å¤æ€§é«˜
- å®¹æ˜“é—æ¼æŸäº›æµ‹è¯•åœºæ™¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- äº”ç»´åº¦æµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨ç”Ÿæˆ
- åŸºäºæ¥å£å®šä¹‰æ™ºèƒ½ç”Ÿæˆæµ‹è¯•æ•°æ®
- è¦†ç›–å¸¸è§æµ‹è¯•åœºæ™¯

**æ•ˆæœ**ï¼šæµ‹è¯•ç”¨ä¾‹ç¼–å†™å·¥ä½œé‡å‡å°‘80%ä»¥ä¸Š

### é—®é¢˜3ï¼šæµ‹è¯•ç»“æœéš¾ä»¥åˆ†æå’Œè¿½è¸ª

**é—®é¢˜æè¿°**ï¼š
- æµ‹è¯•ç»“æœåˆ†æ•£ï¼Œéš¾ä»¥æ±‡æ€»
- ç¼ºå°‘è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- éš¾ä»¥è¿½è¸ªå†å²æµ‹è¯•ç»“æœ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç”ŸæˆHTMLå¯è§†åŒ–æŠ¥å‘Š
- ç”ŸæˆExcelç»“æ„åŒ–æŠ¥å‘Š
- åŒ…å«è¯¦ç»†çš„è¯·æ±‚/å“åº”ä¿¡æ¯å’Œé—®é¢˜åˆ†æ

**æ•ˆæœ**ï¼šæµ‹è¯•ç»“æœä¸€ç›®äº†ç„¶ï¼Œé—®é¢˜å®šä½æ•ˆç‡æå‡

### é—®é¢˜4ï¼šæµ‹è¯•ç¯å¢ƒé…ç½®å¤æ‚

**é—®é¢˜æè¿°**ï¼š
- éœ€è¦æ‰‹åŠ¨é…ç½®æœåŠ¡å™¨åœ°å€
- éœ€è¦æ‰‹åŠ¨æ‹‰å–ä»£ç 
- éœ€è¦æ‰‹åŠ¨ç”Ÿæˆprotobufä»£ç 

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç»Ÿä¸€é…ç½®æ–‡ä»¶ç®¡ç†
- è‡ªåŠ¨Gitæ‹‰å–å’Œæ›´æ–°
- è‡ªåŠ¨è§£æProtobufï¼ˆæ— éœ€ç”ŸæˆPythonä»£ç ï¼‰

**æ•ˆæœ**ï¼šä¸€é”®è¿è¡Œï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦é«˜

---

## ğŸ—ï¸ æ ¸å¿ƒå®ç°åŸç†

### 1. Protobufè§£ææœºåˆ¶

**å®ç°åŸç†**ï¼š
```python
# 1. è¯»å–.protoæ–‡ä»¶
with open(proto_file, 'r', encoding='utf-8') as f:
    content = f.read()

# 2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–rpcæ–¹æ³•
rpc_pattern = r'rpc\s+(\w+)\s*\([^)]*\)\s*returns\s*\([^)]*\)'
rpc_matches = re.findall(rpc_pattern, content)

# 3. è§£æè¯·æ±‚/å“åº”æ¶ˆæ¯ç»“æ„
message_pattern = r'message\s+(\w+)\s*\{([^}]+)\}'
message_matches = re.findall(message_pattern, content)

# 4. æå–å­—æ®µä¿¡æ¯ï¼ˆå­—æ®µåã€ç±»å‹ã€ç¼–å·ï¼‰
field_pattern = r'(\w+)\s+(\w+)\s*=\s*(\d+);'
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æï¼Œæ— éœ€protocç¼–è¯‘å™¨
- æå–æ¥å£å…ƒæ•°æ®ï¼ˆåç§°ã€å‚æ•°ã€è¿”å›ç±»å‹ï¼‰
- æ„å»ºæ¥å£ç»“æ„æ ‘

### 2. TCPé€šä¿¡æœºåˆ¶

**å®ç°åŸç†**ï¼š
```python
# 1. HTTPç™»å½•è·å–token
response = requests.post(login_url, json=login_data)
token = response.json()['token']

# 2. TCPè¿æ¥GateæœåŠ¡å™¨
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((gate_host, gate_port))

# 3. å‘é€è®¤è¯æ¶ˆæ¯
auth_msg = encode_auth_message(token)
sock.send(auth_msg)

# 4. ç¼–ç è¯·æ±‚ä¸ºProtobuf
request_bytes = encode_protobuf(service, method, request_data)

# 5. æ„å»ºTCPæ¶ˆæ¯ï¼ˆé•¿åº¦+æ•°æ®ï¼‰
message = struct.pack('>I', len(request_bytes)) + request_bytes
sock.send(message)

# 6. æ¥æ”¶å“åº”
length_bytes = sock.recv(4)
length = struct.unpack('>I', length_bytes)[0]
response_bytes = sock.recv(length)

# 7. è§£ç Protobufå“åº”
response = decode_protobuf(response_bytes)
```

**å…³é”®ç‚¹**ï¼š
- TCPæ¶ˆæ¯æ ¼å¼ï¼š4å­—èŠ‚é•¿åº¦ + Protobufæ•°æ®
- å¤§ç«¯åºï¼ˆ>Iï¼‰ç¼–ç é•¿åº¦
- éœ€è¦å¤„ç†ç²˜åŒ…å’Œæ‹†åŒ…

### 3. Protobufç¼–ç /è§£ç 

**å®ç°åŸç†**ï¼š
```python
# 1. åŠ¨æ€å¯¼å…¥protobufæ¨¡å—
proto_module = importlib.import_module(f'generated_proto.client.{service}_reqrsp_pb2')

# 2. è·å–è¯·æ±‚æ¶ˆæ¯ç±»
request_class = getattr(proto_module, f'{method}Req')

# 3. åˆ›å»ºæ¶ˆæ¯å®ä¾‹
request_msg = request_class()

# 4. è®¾ç½®å­—æ®µå€¼
for field_name, field_value in request_data.items():
    setattr(request_msg, field_name, field_value)

# 5. åºåˆ—åŒ–ä¸ºå­—èŠ‚
request_bytes = request_msg.SerializeToString()

# 6. ååºåˆ—åŒ–å“åº”
response_class = getattr(proto_module, f'{method}Rsp')
response_msg = response_class()
response_msg.ParseFromString(response_bytes)
```

**å…³é”®ç‚¹**ï¼š
- åŠ¨æ€å¯¼å…¥protobufæ¨¡å—
- ä½¿ç”¨åå°„è®¾ç½®å­—æ®µå€¼
- å¤„ç†åµŒå¥—æ¶ˆæ¯å’Œæ•°ç»„ç±»å‹

### 4. æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæœºåˆ¶

**å®ç°åŸç†**ï¼š
```python
# 1. è§£ææ¥å£å®šä¹‰ï¼Œè·å–å‚æ•°ç»“æ„
request_structure = parse_request_structure(service, method)

# 2. ä¸ºæ¯ä¸ªç»´åº¦ç”Ÿæˆç”¨ä¾‹
for dimension in ['æ­£å¸¸', 'å‚æ•°å¼‚å¸¸', 'ä¸šåŠ¡å¼‚å¸¸', 'æƒé™å®‰å…¨', 'æ€§èƒ½è¾¹ç•Œ']:
    test_case = generate_test_case(service, method, dimension, request_structure)
    test_cases.append(test_case)

# 3. ç”Ÿæˆæµ‹è¯•æ•°æ®
def generate_normal_value(field_name, field_type):
    # æ ¹æ®å­—æ®µç±»å‹ç”Ÿæˆåˆç†å€¼
    if field_type == 'string':
        return f"test_{field_name}"
    elif field_type == 'int32':
        return 10000263
    # ...

# 4. ç”Ÿæˆå¼‚å¸¸æ•°æ®
def generate_abnormal_value(field_name, field_type, abnormal_type):
    if abnormal_type == 'å¿…å¡«ç¼ºå¤±':
        return None
    elif abnormal_type == 'ç±»å‹é”™è¯¯':
        return "wrong_type" if field_type.startswith('int') else 123
    # ...
```

**å…³é”®ç‚¹**ï¼š
- åŸºäºæ¥å£å®šä¹‰æ™ºèƒ½ç”Ÿæˆæµ‹è¯•æ•°æ®
- ä¸åŒç»´åº¦ä½¿ç”¨ä¸åŒçš„æ•°æ®ç”Ÿæˆç­–ç•¥
- éœ€è¦å¤„ç†åµŒå¥—ç»“æ„å’Œå¤æ‚ç±»å‹

### 5. æŠ¥å‘Šç”Ÿæˆæœºåˆ¶

**å®ç°åŸç†**ï¼š
```python
# HTMLæŠ¥å‘Š
# 1. ä½¿ç”¨Jinja2æ¨¡æ¿
template = env.get_template('report_template.html')

# 2. æ¸²æŸ“æ•°æ®
html_content = template.render(
    total_interfaces=len(interfaces),
    passed_count=passed_count,
    failed_count=failed_count,
    test_results=test_results
)

# 3. ä¿å­˜æ–‡ä»¶
with open(report_path, 'w', encoding='utf-8') as f:
    f.write(html_content)

# ExcelæŠ¥å‘Š
# 1. åˆ›å»ºå·¥ä½œç°¿
wb = openpyxl.Workbook()

# 2. åˆ›å»ºæ±‡æ€»è¡¨
summary_sheet = wb.active
summary_sheet.title = "æ±‡æ€»"

# 3. ä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºå·¥ä½œè¡¨
for service_name, service_results in test_results.items():
    sheet = wb.create_sheet(service_name.upper())
    # å†™å…¥æ•°æ®ï¼Œè®¾ç½®æ ·å¼ï¼ˆé¢œè‰²ã€æ ¼å¼ç­‰ï¼‰

# 4. ä¿å­˜æ–‡ä»¶
wb.save(excel_path)
```

**å…³é”®ç‚¹**ï¼š
- HTMLä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼Œä¾¿äºå®šåˆ¶æ ·å¼
- Excelä½¿ç”¨openpyxlï¼Œæ”¯æŒå¤æ‚æ ¼å¼å’Œæ ·å¼
- éœ€è¦å¤„ç†å¤§é‡æ•°æ®æ—¶çš„æ€§èƒ½é—®é¢˜

---

## ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

### 1. åŠ¨æ€å¯¼å…¥Protobufæ¨¡å—

**é—®é¢˜**ï¼šä¸åŒæœåŠ¡çš„protobufæ¨¡å—ä¸åŒï¼Œéœ€è¦åŠ¨æ€å¯¼å…¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
import importlib

def get_proto_module(service_name):
    module_name = f'generated_proto.client.{service_name}_reqrsp_pb2'
    return importlib.import_module(module_name)
```

**æ³¨æ„**ï¼šéœ€è¦ç¡®ä¿protobufæ–‡ä»¶å·²ç”Ÿæˆæˆ–å·²å­˜åœ¨

### 2. åå°„è®¾ç½®Protobufå­—æ®µ

**é—®é¢˜**ï¼šå­—æ®µåæ˜¯åŠ¨æ€çš„ï¼Œéœ€è¦åå°„è®¾ç½®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def set_protobuf_field(msg, field_name, field_value):
    try:
        setattr(msg, field_name, field_value)
    except Exception as e:
        # å¤„ç†å­—æ®µä¸å­˜åœ¨ã€ç±»å‹ä¸åŒ¹é…ç­‰æƒ…å†µ
        logger.error(f"è®¾ç½®å­—æ®µå¤±è´¥: {field_name}, é”™è¯¯: {e}")
```

**æ³¨æ„**ï¼šéœ€è¦å¤„ç†å­—æ®µä¸å­˜åœ¨ã€ç±»å‹ä¸åŒ¹é…ã€åµŒå¥—æ¶ˆæ¯ç­‰æƒ…å†µ

### 3. åµŒå¥—æ¶ˆæ¯å¤„ç†

**é—®é¢˜**ï¼šProtobufæ”¯æŒåµŒå¥—æ¶ˆæ¯ï¼Œéœ€è¦é€’å½’å¤„ç†

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def encode_nested_message(msg_class, data):
    msg = msg_class()
    for key, value in data.items():
        if isinstance(value, dict):
            # åµŒå¥—æ¶ˆæ¯ï¼Œé€’å½’å¤„ç†
            nested_class = getattr(msg_class, key)
            nested_msg = encode_nested_message(nested_class, value)
            setattr(msg, key, nested_msg)
        else:
            setattr(msg, key, value)
    return msg
```

**æ³¨æ„**ï¼šéœ€è¦æ­£ç¡®è¯†åˆ«åµŒå¥—æ¶ˆæ¯ç±»å‹

### 4. è¯·æ±‚æ•°æ®æ ¼å¼è½¬æ¢

**é—®é¢˜**ï¼šYAMLä¸­çš„è¯·æ±‚æ•°æ®æ ¼å¼å’ŒProtobufæ ¼å¼ä¸åŒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def convert_request_data(request_data):
    """
    è½¬æ¢YAMLæ ¼å¼åˆ°Protobufæ ¼å¼
    YAMLæ ¼å¼: {"field": {"value": 123, "type": "int32"}}
    Protobufæ ¼å¼: {"field": 123}
    """
    converted = {}
    for key, value in request_data.items():
        if isinstance(value, dict) and 'value' in value:
            converted[key] = value['value']
        else:
            converted[key] = value
    return converted
```

**æ³¨æ„**ï¼šéœ€è¦å¤„ç†Noneå€¼ã€åµŒå¥—ç»“æ„ã€æ•°ç»„ç±»å‹

### 5. é”™è¯¯å¤„ç†å’Œæ—¥å¿—

**é—®é¢˜**ï¼šéœ€è¦è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ç”¨äºé—®é¢˜å®šä½

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
try:
    result = client.call_rpc(service, method, request_data)
except ConnectionError as e:
    logger.error(f"è¿æ¥å¤±è´¥: {service}.{method}, é”™è¯¯: {e}")
except EncodingError as e:
    logger.error(f"ç¼–ç å¤±è´¥: {service}.{method}, è¯·æ±‚æ•°æ®: {request_data}, é”™è¯¯: {e}")
except RPCError as e:
    logger.error(f"RPCè°ƒç”¨å¤±è´¥: {service}.{method}, é”™è¯¯ç : {e.error_code}, é”™è¯¯ä¿¡æ¯: {e.error_message}")
```

**æ³¨æ„**ï¼šéœ€è¦åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ï¼Œæä¾›è¯¦ç»†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

---

## âš ï¸ å®ç°è¿‡ç¨‹ä¸­çš„å…³é”®å‘

### å‘1ï¼šæ¥å£å‰ç½®æ¡ä»¶å¤„ç†

**é—®é¢˜**ï¼šæŸäº›æ¥å£éœ€è¦å‰ç½®æ¡ä»¶ï¼Œå¦‚ `JoinTeam` éœ€è¦å…ˆ `CreateTeam` è·å– `team_id`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def _run_all_tests_from_yaml(self):
    # å¯¹äºéœ€è¦å‰ç½®æ¡ä»¶çš„æ¥å£ï¼Œå…ˆæ‰§è¡Œå‰ç½®æ“ä½œ
    if service == 'Room' and method == 'JoinTeam' and dimension == 'æ­£å¸¸':
        # å…ˆåˆ›å»ºé˜Ÿä¼
        create_result = client.call_rpc('Room', 'CreateTeam', {
            'game_mode': 1,
            'map_id': 10000263
        })
        if create_result.get('error_code') == 200:
            team_id = create_result['response']['createteam']['team_id']
            # æ³¨å…¥åˆ°è¯·æ±‚ä¸­
            actual_request['team_id'] = team_id
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… éœ€è¦åœ¨æ­£å¸¸ç”¨ä¾‹ä¸­å¤„ç†å‰ç½®æ¡ä»¶
- âœ… å¼‚å¸¸ç”¨ä¾‹ä¸éœ€è¦å‰ç½®æ¡ä»¶ï¼ˆæµ‹è¯•çš„å°±æ˜¯å¼‚å¸¸åœºæ™¯ï¼‰
- âœ… éœ€è¦åŠ¨æ€è·å–å‰ç½®æ¡ä»¶çš„ç»“æœï¼ˆå¦‚team_idï¼‰
- âœ… éœ€è¦å¤„ç†å‰ç½®æ¡ä»¶å¤±è´¥çš„æƒ…å†µ

**ç±»ä¼¼åœºæ™¯**ï¼š
- `Match` éœ€è¦å…ˆ `CreateTeam`
- `SendMessage` åœ¨æŸäº›åœºæ™¯ä¸‹éœ€è¦å…ˆåˆ›å»ºä¼šè¯
- `GetTeamInfo` éœ€è¦å…ˆåŠ å…¥é˜Ÿä¼

### å‘2ï¼šProtobufå­—æ®µç±»å‹å¤„ç†

**é—®é¢˜**ï¼šProtobufå­—æ®µç±»å‹å’ŒPythonç±»å‹ä¸å®Œå…¨å¯¹åº”

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def convert_value_to_protobuf_type(value, proto_type):
    """è½¬æ¢Pythonå€¼åˆ°Protobufç±»å‹"""
    if proto_type.startswith('int'):
        return int(value)
    elif proto_type == 'string':
        return str(value) if value is not None else ""
    elif proto_type == 'bool':
        return bool(value)
    elif proto_type.startswith('repeated'):
        # æ•°ç»„ç±»å‹
        return list(value) if isinstance(value, (list, tuple)) else [value]
    # åµŒå¥—æ¶ˆæ¯ç±»å‹éœ€è¦ç‰¹æ®Šå¤„ç†
    elif proto_type not in ['int32', 'int64', 'string', 'bool']:
        # å¯èƒ½æ˜¯åµŒå¥—æ¶ˆæ¯
        return encode_nested_message(proto_type, value)
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… int32/int64éœ€è¦æ˜ç¡®åŒºåˆ†
- âœ… stringç±»å‹çš„Noneéœ€è¦è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²
- âœ… repeatedç±»å‹éœ€è¦è½¬æ¢ä¸ºlist
- âœ… åµŒå¥—æ¶ˆæ¯éœ€è¦é€’å½’å¤„ç†

### å‘3ï¼šTCPæ¶ˆæ¯ç²˜åŒ…å’Œæ‹†åŒ…

**é—®é¢˜**ï¼šTCPæ˜¯æµå¼åè®®ï¼Œå¯èƒ½å‡ºç°ç²˜åŒ…å’Œæ‹†åŒ…

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def recv_message(sock):
    """æ¥æ”¶å®Œæ•´æ¶ˆæ¯"""
    # å…ˆæ¥æ”¶4å­—èŠ‚é•¿åº¦
    length_bytes = b''
    while len(length_bytes) < 4:
        chunk = sock.recv(4 - len(length_bytes))
        if not chunk:
            raise ConnectionError("è¿æ¥å·²å…³é—­")
        length_bytes += chunk
    
    length = struct.unpack('>I', length_bytes)[0]
    
    # æ¥æ”¶å®Œæ•´æ•°æ®
    data = b''
    while len(data) < length:
        chunk = sock.recv(length - len(data))
        if not chunk:
            raise ConnectionError("è¿æ¥å·²å…³é—­")
        data += chunk
    
    return data
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… å¿…é¡»å®Œæ•´æ¥æ”¶4å­—èŠ‚é•¿åº¦
- âœ… å¿…é¡»å®Œæ•´æ¥æ”¶æŒ‡å®šé•¿åº¦çš„æ•°æ®
- âœ… éœ€è¦å¤„ç†è¿æ¥å…³é—­çš„æƒ…å†µ
- âœ… éœ€è¦è®¾ç½®è¶…æ—¶é¿å…é˜»å¡

### å‘4ï¼šYAMLä¸­nullå€¼å¤„ç†

**é—®é¢˜**ï¼šYAMLä¸­çš„ `null` åœ¨Pythonä¸­æ˜¯ `None`ï¼Œä½†Protobufä¸æ¥å— `None`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def handle_null_value(field_name, field_type, method_name):
    """å¤„ç†nullå€¼"""
    # æŸäº›å­—æ®µå¯ä»¥ä¸ºç©ºå­—ç¬¦ä¸²
    if field_type == 'string':
        return ""
    
    # æŸäº›å­—æ®µéœ€è¦é»˜è®¤å€¼
    if method_name == 'SendMessage' and field_name == 'content':
        # æ„é€ é»˜è®¤çš„ChatMsgContent
        return create_default_chat_msg_content()
    
    # å…¶ä»–æƒ…å†µè¿”å›Noneï¼Œè®©Protobufå¤„ç†
    return None
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… éœ€è¦æ ¹æ®å­—æ®µç±»å‹å’Œæ¥å£ç‰¹ç‚¹å¤„ç†
- âœ… æŸäº›å­—æ®µå¯ä»¥ä¸ºç©ºå­—ç¬¦ä¸²
- âœ… æŸäº›å­—æ®µéœ€è¦æ„é€ é»˜è®¤å¯¹è±¡
- âœ… éœ€è¦è®°å½•å¤„ç†é€»è¾‘ï¼Œä¾¿äºç»´æŠ¤

### å‘5ï¼šæµ‹è¯•ç”¨ä¾‹çŠ¶æ€åˆ¤æ–­

**é—®é¢˜**ï¼šæ­£å¸¸ç”¨ä¾‹å’Œå¼‚å¸¸ç”¨ä¾‹çš„çŠ¶æ€åˆ¤æ–­é€»è¾‘ä¸åŒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def determine_test_status(actual_error_code, dimension, expected_status):
    """åˆ¤æ–­æµ‹è¯•çŠ¶æ€"""
    if dimension == 'æ­£å¸¸':
        # æ­£å¸¸ç”¨ä¾‹ï¼šerror_code == 200 ä¸ºé€šè¿‡
        return 'é€šè¿‡' if actual_error_code == 200 else 'ä¸é€šè¿‡'
    else:
        # å¼‚å¸¸ç”¨ä¾‹ï¼šerror_code != 200 ä¸ºé€šè¿‡
        return 'é€šè¿‡' if actual_error_code != 200 else 'ä¸é€šè¿‡'
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… æ­£å¸¸ç”¨ä¾‹ï¼šæˆåŠŸï¼ˆ200ï¼‰ä¸ºé€šè¿‡
- âœ… å¼‚å¸¸ç”¨ä¾‹ï¼šå¤±è´¥ï¼ˆé200ï¼‰ä¸ºé€šè¿‡
- âœ… éœ€è¦æ ¹æ®ç»´åº¦åˆ¤æ–­ï¼Œä¸èƒ½ç»Ÿä¸€å¤„ç†
- âœ… éœ€è¦è®°å½•åˆ¤æ–­é€»è¾‘ï¼Œé¿å…æ··æ·†

### å‘6ï¼šæœåŠ¡å’Œæ–¹æ³•åç§°æ˜ å°„

**é—®é¢˜**ï¼šæœåŠ¡åç§°å’Œæ–¹æ³•åç§°éœ€è¦æ˜ å°„åˆ°protobufä¸­çš„å®é™…åç§°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
class ServiceRegistry:
    """æœåŠ¡æ³¨å†Œè¡¨"""
    _services = {
        'Hall': {
            'command': 2,
            'methods': {
                'FetchSelfFullUserInfo': 2,
                'UpdateNickname': 4,
                # ...
            }
        },
        # ...
    }
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… éœ€è¦ç»´æŠ¤æœåŠ¡å’Œæ–¹æ³•æ˜ å°„è¡¨
- âœ… æ–°å¢æœåŠ¡æ—¶éœ€è¦æ›´æ–°æ˜ å°„è¡¨
- âœ… éœ€è¦å¤„ç†å¤§å°å†™é—®é¢˜ï¼ˆHall vs hallï¼‰
- âœ… éœ€è¦éªŒè¯æ˜ å°„çš„æ­£ç¡®æ€§

### å‘7ï¼šExcelæŠ¥å‘Šæ ¼å¼å’Œæ€§èƒ½

**é—®é¢˜**ï¼šå¤§é‡æµ‹è¯•ç”¨ä¾‹æ—¶ï¼ŒExcelç”Ÿæˆæ…¢ï¼Œæ ¼å¼å¤æ‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. æ‰¹é‡å†™å…¥æ•°æ®ï¼Œå‡å°‘IO
rows_data = []
for test_case in test_cases:
    rows_data.append(format_test_case_row(test_case))
sheet.append(rows_data)  # æ‰¹é‡è¿½åŠ 

# 2. ä½¿ç”¨æ ·å¼å¯¹è±¡ï¼Œé¿å…é‡å¤åˆ›å»º
header_style = NamedStyle(name="header", ...)
for cell in header_row:
    cell.style = header_style

# 3. è®¾ç½®åˆ—å®½å’Œè¡Œé«˜
sheet.column_dimensions['A'].width = 15
sheet.row_dimensions[1].height = 30
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… æ‰¹é‡æ“ä½œå‡å°‘IOæ¬¡æ•°
- âœ… å¤ç”¨æ ·å¼å¯¹è±¡å‡å°‘å†…å­˜
- âœ… åˆç†è®¾ç½®åˆ—å®½é¿å…å†…å®¹è¢«æˆªæ–­
- âœ… å¤§é‡æ•°æ®æ—¶è€ƒè™‘åˆ†é¡µæˆ–åˆ†æ‰¹å¤„ç†

### å‘8ï¼šGitæ›´æ–°å¤±è´¥å¤„ç†

**é—®é¢˜**ï¼šGitæ›´æ–°å¯èƒ½å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜ã€æƒé™é—®é¢˜ç­‰ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def check_and_update(self):
    try:
        if not os.path.exists(self.repo_path):
            self._clone_repo()
        else:
            self._pull_update()
    except Exception as e:
        logger.warning(f"Gitæ›´æ–°å¤±è´¥: {e}")
        # ç»§ç»­æ‰§è¡Œï¼Œä½¿ç”¨æœ¬åœ°å·²æœ‰ä»£ç 
        return False, set()
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… Gitæ›´æ–°å¤±è´¥ä¸åº”è¯¥é˜»æ­¢æµ‹è¯•æ‰§è¡Œ
- âœ… åº”è¯¥è®°å½•è­¦å‘Šä¿¡æ¯
- âœ… å¯ä»¥ä½¿ç”¨ `--skip-git-check` è·³è¿‡
- âœ… éœ€è¦æç¤ºç”¨æˆ·æ£€æŸ¥ç½‘ç»œå’Œæƒé™

---

## ğŸ¨ æ¶æ„è®¾è®¡æ€è€ƒ

### 1. æ¨¡å—åŒ–è®¾è®¡

**è®¾è®¡åŸåˆ™**ï¼š
- æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€
- æ¨¡å—é—´ä½è€¦åˆ
- ä¾¿äºæ‰©å±•å’Œç»´æŠ¤

**æ¨¡å—åˆ’åˆ†**ï¼š
- `config.py` - é…ç½®ç®¡ç†
- `client.py` - APIå®¢æˆ·ç«¯
- `test_generator.py` - æµ‹è¯•ä»£ç ç”Ÿæˆ
- `test_case_generator.py` - æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
- `report_generator.py` - æŠ¥å‘Šç”Ÿæˆ

### 2. å¯æ‰©å±•æ€§è®¾è®¡

**è®¾è®¡è€ƒè™‘**ï¼š
- æ–°å¢æœåŠ¡ï¼šåªéœ€åœ¨ `service_registry.py` ä¸­æ³¨å†Œ
- æ–°å¢æµ‹è¯•ç»´åº¦ï¼šåœ¨ `base_test_case_generator.py` ä¸­æ‰©å±•
- æ–°å¢æŠ¥å‘Šæ ¼å¼ï¼šåœ¨ `report_generators.py` ä¸­æ‰©å±•
- æ”¯æŒä¸åŒæµ‹è¯•æ¡†æ¶ï¼šé€šè¿‡ `test_generator.py` å’Œ `pytest_test_generator.py` å®ç°

### 3. é”™è¯¯å¤„ç†è®¾è®¡

**è®¾è®¡åŸåˆ™**ï¼š
- åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ï¼ˆè¿æ¥é”™è¯¯ã€ç¼–ç é”™è¯¯ã€RPCé”™è¯¯ï¼‰
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- é”™è¯¯ä¸åº”è¯¥å¯¼è‡´æ•´ä¸ªæµç¨‹å¤±è´¥ï¼ˆæŸäº›é”™è¯¯å¯ä»¥è·³è¿‡ï¼‰

**å®ç°æ–¹å¼**ï¼š
- è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼ˆ`ConnectionError`, `EncodingError`, `RPCError`ï¼‰
- ç»Ÿä¸€æ—¥å¿—è®°å½•
- é”™è¯¯ä¿¡æ¯åŒ…å«ä¸Šä¸‹æ–‡ï¼ˆæœåŠ¡åã€æ–¹æ³•åã€è¯·æ±‚æ•°æ®ç­‰ï¼‰

### 4. æ•°æ®æµè½¬è®¾è®¡

**æ•°æ®æµè½¬**ï¼š
```
Protobufæ–‡ä»¶ â†’ è§£æå™¨ â†’ æ¥å£å®šä¹‰
æ¥å£å®šä¹‰ â†’ ç”Ÿæˆå™¨ â†’ æµ‹è¯•ä»£ç /æµ‹è¯•ç”¨ä¾‹
æµ‹è¯•ç”¨ä¾‹ â†’ è½¬æ¢å™¨ â†’ è¯·æ±‚æ•°æ®
è¯·æ±‚æ•°æ® â†’ å®¢æˆ·ç«¯ â†’ å®é™…è°ƒç”¨
å®é™…è°ƒç”¨ â†’ è¿è¡Œå™¨ â†’ æµ‹è¯•ç»“æœ
æµ‹è¯•ç»“æœ â†’ æŠ¥å‘Šç”Ÿæˆå™¨ â†’ HTML/ExcelæŠ¥å‘Š
```

**å…³é”®ç‚¹**ï¼š
- æ¯ä¸ªç¯èŠ‚çš„æ•°æ®æ ¼å¼æ˜ç¡®
- æ•°æ®è½¬æ¢é€»è¾‘é›†ä¸­ç®¡ç†
- ä¾¿äºè°ƒè¯•å’Œé—®é¢˜å®šä½

---

## ğŸ“ æ€»ç»“

### æ¡†æ¶æ ¸å¿ƒä»·å€¼

1. **è‡ªåŠ¨åŒ–** - ä»æ¥å£å®šä¹‰åˆ°æµ‹è¯•æ‰§è¡Œå…¨æµç¨‹è‡ªåŠ¨åŒ–
2. **æ™ºèƒ½åŒ–** - è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å’Œæµ‹è¯•ä»£ç 
3. **çœŸå®åŒ–** - çœŸå®APIè°ƒç”¨ï¼Œå‘ç°å®é™…é—®é¢˜
4. **å¯è§†åŒ–** - å¤šæ ¼å¼æŠ¥å‘Šï¼Œä¾¿äºåˆ†æå’Œè¿½è¸ª

### å…³é”®æŠ€æœ¯

1. **Protobufè§£æ** - æ­£åˆ™è¡¨è¾¾å¼è§£æï¼Œæ— éœ€ç¼–è¯‘å™¨
2. **TCPé€šä¿¡** - å¤„ç†ç²˜åŒ…æ‹†åŒ…ï¼Œæ¶ˆæ¯ç¼–ç è§£ç 
3. **åŠ¨æ€ä»£ç ç”Ÿæˆ** - æ¨¡æ¿å¼•æ“ç”Ÿæˆæµ‹è¯•ä»£ç 
4. **æ™ºèƒ½æ•°æ®ç”Ÿæˆ** - åŸºäºæ¥å£å®šä¹‰ç”Ÿæˆæµ‹è¯•æ•°æ®

### å…³é”®æ³¨æ„äº‹é¡¹

1. **å‰ç½®æ¡ä»¶å¤„ç†** - æŸäº›æ¥å£éœ€è¦å…ˆæ‰§è¡Œå‰ç½®æ“ä½œ
2. **ç±»å‹è½¬æ¢** - Protobufç±»å‹å’ŒPythonç±»å‹çš„å¯¹åº”å…³ç³»
3. **é”™è¯¯å¤„ç†** - åŒºåˆ†é”™è¯¯ç±»å‹ï¼Œæä¾›è¯¦ç»†ä¸Šä¸‹æ–‡
4. **çŠ¶æ€åˆ¤æ–­** - æ­£å¸¸ç”¨ä¾‹å’Œå¼‚å¸¸ç”¨ä¾‹çš„åˆ¤æ–­é€»è¾‘ä¸åŒ
5. **æ€§èƒ½ä¼˜åŒ–** - å¤§é‡æ•°æ®æ—¶çš„æ‰¹é‡å¤„ç†å’Œæ ·å¼å¤ç”¨

### æœªæ¥æ”¹è¿›æ–¹å‘

1. **æ”¯æŒæ›´å¤šåè®®** - HTTPã€gRPCç­‰
2. **æ”¯æŒæ›´å¤šæµ‹è¯•æ¡†æ¶** - Robot Frameworkç­‰
3. **æ€§èƒ½ä¼˜åŒ–** - å¹¶å‘æµ‹è¯•ã€æ‰¹é‡å¤„ç†
4. **æ™ºèƒ½åŒ–æå‡** - åŸºäºå†å²æ•°æ®ä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
5. **å¯è§†åŒ–å¢å¼º** - å®æ—¶æµ‹è¯•ç›‘æ§ã€æµ‹è¯•è¶‹åŠ¿åˆ†æ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-12-23  
**ä½œè€…**: APITestSuite Team

